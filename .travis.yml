language: java
sudo: true
branches:
  only:
  - master
jdk:
- openjdk8
before_install:
- openssl aes-256-cbc -K $encrypted_fb365c1216b5_key -iv $encrypted_fb365c1216b5_iv -in anuj-ubuntu-keypair.pem.enc -out anuj-ubuntu-keypair.pem -d
- eval "$(ssh-agent -s)"
- pwd
- ls
- echo "$TRAVIS_BUILD_DIR"
- chmod 600 anuj-ubuntu-keypair.pem
- ssh-add anuj-ubuntu-keypair.pem
- chmod +x mvnw
deploy:
  provider: script
  skip_cleanup: true
  script: cd target && sudo scp -i ../anuj-ubuntu-keypair.pem  -o StrictHostKeyChecking=no -r *.jar ubuntu@ec2-34-202-237-229.compute-1.amazonaws.com:/home/Travis && ssh -n -f -i ../anuj-ubuntu-keypair.pem -o StrictHostKeyChecking=no ubuntu@ec2-34-202-237-229.compute-1.amazonaws.com 'cd /home/Travis && nohup java -jar *.jar > /dev/null 2>&1 &'
deploy:
  provider: s3
  skip_cleanup: true
  access_key_id: AKIAIVINMTSHWI7TWGBQ
  secret_access_key: 
    secure: l9X4LP2PMmwWUzmfpkq/QfrCP2WxiZ55MI45H991vuRjj9QmMUz4sEnXj0DAnANiLACsP4KpqvzIJbd7uWnMZp+wJvPKN3H0cbjPe/g3MAYNp6dtidMGhfRFnNzUQtzEcwKyPdgw929Dy1a1DaOs02kfxvCIQn8xMvMEbSIySbjVlCzFmPUIkv57179tDy4x9xXWtCJDvs37bY1YaDuJMWU9is/Wnt3WCyKVG+olhRalfs+5SNbGYe4SmA2U7lPY8np7E7wqB27FB/iiC69ff1vNOGXSxHVEtXgYiNitN4zX5fU7AJ2sBqLoIjjSTQRO5akq1GZCt98L2hHjRtvz+g3s3/Zmx/ZcBiv7ELlWBVxRUrnLpG75+BB4mhy9Kjkn+9+nvhHSq3QloBNu4HH9wnTvMw0jGAb+WMjhiXjfNPQlf9Hd9iOBsMaZyOB79THs+O0+PLDYl0Nb8y2XM4XETHGPR00p2S9aE+ntErcwFh9xrTm7P+hw4AiapEYhTN5uuLVLh8BddD/YdMzjrmOUyRQVBjJVtJOuhtfp88oAvQXCAjtIjGHv5H3lBtsLXabX5MexZwSQX4XaSGbtfh0jjMjyS5lBRy24J4k8PczNcL7rRBXcwXvwvsHsYlnx/g9pbyQIVCXKEXPc8i6UN6LT6z1CY+NjH/7onToQbq581uY=
  bucket: ods-app-builds
  
after_deploy:
  script: echo "Deployment complete"
script: "./mvnw clean install"
after_success: 